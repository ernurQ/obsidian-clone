(()=>{"use strict";const t=document.querySelector(".modal"),e=t.querySelector(".modal__content");function n(){t.classList.remove("modal_active"),e.innerHTML='\n        <div class="modal__close-btn">&times;</div>\n    '}t.addEventListener("click",(t=>{const e=t.target;null!=e&&(e.classList.contains("modal")||e.classList.contains("modal__close-btn"))&&n()}));class o{constructor(t,e,n){this.content=e,this.path=n,this.title=t}get id(){return this.title}_renderNotesPanel(){const t=document.createElement("li");t.classList.add("notes-panel__note"),t.textContent=this.title,document.querySelector(".notes-panel__list").append(t)}_renderNoteTab(){const t=document.createElement("li");t.classList.add("tab"),t.innerHTML=`\n            <div class="tab__content">${this.title}</div>\n            <div class="tab__close-btn">&times;</div>\n        `,document.querySelector(".tabs-list").append(t)}_renderNoteContent(){const t=document.createElement("li");t.classList.add("note"),t.innerHTML=`\n            <div class="note__header">\n                <input type="text" class="note__title">\n                <button class="note__save-btn"><span class="icon-floppy"></span></button>\n            </div>\n            <textarea class="note__content">${this.content}</textarea>\n        `,t.querySelector(".note__title").value=this.title,document.querySelector(".workspace__notes").append(t)}render(){this._renderNotesPanel(),this._renderNoteTab(),this._renderNoteContent()}open(){this._renderNoteTab(),this._renderNoteContent()}getJson(){return{title:this.title,content:this.content,path:this.path}}}const s=document.querySelector(".workspace__notes");function a(){s.addEventListener("click",(t=>{const e=t.target;null!==e&&(e.classList.contains("icon-floppy")||e.classList.contains("note__save-btn"))&&function(){const t=s.querySelector(".note_active");!function(t){const e="http://localhost:3000/notes",n=t.title;(async function(t,e,n){return fetch(`${t}/${n}`,{method:"PUT",headers:{"Content-type":"application/json"},body:JSON.stringify(e)})})(e,t,n).then((t=>{if(!t.ok)throw new Error(`Could not update ${e}/${n}, status: ${t.status}`)}))}({title:t.querySelector(".note__title").value,content:t.querySelector(".note__content").value,path:"/"})}()}))}function c(t){s.querySelectorAll(".note").forEach((e=>{e.querySelector(".note__title").value!==t?e.classList.remove("note_active"):e.classList.add("note_active")}))}const l=document.querySelector(".tabs-list");function r(t){l.querySelectorAll(".tab").forEach((e=>{e.querySelector(".tab__content").textContent!==t?e.classList.remove("tab_active"):e.classList.add("tab_active")})),c(t)}function i(s){const a=document.createElement("form");a.innerHTML='\n        <form action="#" class="modal__form">\n        <label class="modal__label">\n            Note title\n            <input class="modal__input" name="title">\n        </label>\n        <label class="modal__label">\n            Note path\n            <input class="modal__input" placeholder="/" name="path">\n        </label>\n\n        <button class="modal__submit">create</button>\n        </form>\n    ',s.addEventListener("click",(()=>{var n;n=a,t.classList.add("modal_active"),e.append(n)})),a.addEventListener("submit",(t=>{t.preventDefault();let{title:e,path:s}=Object.fromEntries(new FormData(a).entries());if(""===s&&(s="/"),""===e)return;if(function(t){const e=u.querySelectorAll(".notes-panel__note");for(const n of e)if(n.textContent===t)return!0;return!1}(e))return;a.reset(),n();const l=new o(e,"",s);l.render(),r(e),c(e),function(t){const e="http://localhost:3000/notes";(async function(t,e){return fetch(t,{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(e)})})(e,t).then((t=>{if(!t.ok)throw new Error(`Could not post ${e}, status: ${t.status}`)}))}(l.getJson())}))}const u=document.querySelector(".notes-panel"),d=u.querySelector(".notes-panel__list");function _(){i(u.querySelector(".notes-panel__new-note")),async function(t){const e=await fetch(t);if(!e.ok)throw new Error(`Could not fetch ${t}, status: ${e.status}`);return await e.json()}("http://localhost:3000/notes").then((t=>{t.forEach((t=>function(t){const e=document.createElement("li");e.classList.add("notes-panel__note"),e.textContent=t,d.append(e)}(t.title)))})),d.addEventListener("click",(t=>{const e=t.target;if(null!==e&&e.classList.contains("notes-panel__note")){const t=e.textContent;if(function(t){const e=l.querySelectorAll(".tab");for(const n of e)if(n.querySelector(".tab__content").textContent===t)return!0;return!1}(t))return r(t),void c(t);new o(t,"","/").open(),r(t),c(t)}}))}document.addEventListener("DOMContentLoaded",(()=>{!function(){const t=document.querySelector(".navbar__notes-panel-btn"),e=document.querySelector(".notes-panel");t.addEventListener("click",(()=>{e.classList.toggle("notes-panel_collapsed")}))}(),_(),l.addEventListener("click",(t=>{const e=t.target;if(null!==e){if(e.classList.contains("tab__close-btn")){const t=e,n=e.parentElement;return n.classList.add("tab_collapsed"),t.remove(),function(t){const e=s.querySelectorAll(".note");for(let n=0;n<e.length;n++){const o=e[n];if(o.querySelector(".note__header").value===t&&(o.remove(),o.classList.contains("note_active")&&e.length>1)){const t=e[0===n?1:0].querySelector(".note__header").value;r(t),c(t)}}}(n.querySelector(".tab__content").textContent),void setTimeout((()=>{n.remove()}),250)}if(e.classList.contains("tab__content")){if(e.parentElement.classList.contains("tab_active"))return;r(e.textContent)}if(e.classList.contains("tab")){if(e.classList.contains("tab_active"))return;r(e.querySelector(".tab__content").textContent)}}})),a()}))})();